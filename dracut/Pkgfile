# Description: Event-driven initramfs infrastructure
# URL:         https://dracut.wiki.kernel.org/index.php/Main_Page
# Maintainer:  Alexandr Savca, alexandrsavca89 at gmail dot com
# Depends on:  kmod

name=dracut
version=050
release=1
source=(https://mirrors.edge.kernel.org/pub/linux/utils/boot/$name/$name-$version.tar.xz
	0001-cryptroot-ask-no-warn-if-run-cryptsetup-exist.patch
	10-crux.conf
	installkernel
	arch)

build() {
	cd $name-$version

	patch -p0 < $SRC/0001-cryptroot-ask-no-warn-if-run-cryptsetup-exist.patch

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc
	make
	make DESTDIR=$PKG install

	# CRUX' initramfs config
	cp $SRC/10-crux.conf $PKG/etc/dracut.conf.d/

	# kernel install script
	install -Dm 0755 $SRC/installkernel $PKG/sbin/installkernel

	# fix "/usr/lib/dracut/modules.d/90crypt/module-setup.sh: line 28: arch: command not found"
	install -Dm 0755 $SRC/arch $PKG/bin/arch

	rm $PKG/usr/lib/$name/modules.d/*/README*
}
