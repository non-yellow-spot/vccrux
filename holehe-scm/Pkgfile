# Description: Check if the email is used on different sites
# URL:         https://github.com/megadose/holehe
# Maintainer:  Alexandr Savca, alexandrsavca89 at gmail dot com
# Depends on:  git python3-lxml python3-mechanize python3-requests python3-tqdm

name=holehe-scm
version=$(date +%Y%m%d)
release=1
source=(0001-remove-termcolor-dep.patch
	0001-print-action-message-instead-of-url-like-something-i.patch
	holehe.py)

download_git() {
	if [[ -d $PKGMK_SOURCE_DIR/$name ]]; then
		git -C $PKGMK_SOURCE_DIR/$name fetch --depth=1
		git -C $PKGMK_SOURCE_DIR/$name clean -f
		git -C $PKGMK_SOURCE_DIR/$name reset --hard origin/$2
	else
		git -C $PKGMK_SOURCE_DIR clone --depth=1 $1 -b $2 $name
	fi

	cp -r $PKGMK_SOURCE_DIR/$name $PKGMK_WORK_DIR/src/$name
}

build() {
	download_git https://github.com/megadose/${name/-scm} master
	cd $name

	patch -p1 < $SRC/0001-remove-termcolor-dep.patch
	patch -p1 < $SRC/0001-print-action-message-instead-of-url-like-something-i.patch
	
	python3 setup.py build
	python3 setup.py install --prefix=/usr --root=$PKG --optimize=1

	# remove pycrap
	rm -r $PKG/usr/lib/python*/site-packages/holehe-*-py*.egg-info/

	# remove pycrap autogenerated launcher
	rm $PKG/usr/bin/holehe

	# install our own launcher
	install -Dm755 $SRC/holehe.py $PKG/usr/bin/holehe
}
