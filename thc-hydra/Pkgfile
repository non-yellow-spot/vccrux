# Description: Network logon cracker
# URL:         https://github.com/vanhauser-thc/thc-hydra
# Maintainer:  Alexandr Savca, alexandrsavca89 at gmail dot com
# Depends on:  freerdp2 gtk libidn libssh mysql postgresql subversion

name=thc-hydra
version=9.1
release=1
source=(https://github.com/vanhauser-thc/$name/archive/v$version/$name-v$version.tar.gz)

build() {
	cd $name-$version

	sed -i 's/dummy_ssh/dummy_sshkey/' hydra-sshkey.c
	sed -i 's/OPTS=-I. -O3 $(CFLAGS) -fcommon/OPTS=-I. $(CFLAGS) -fcommon/' \
		Makefile.am

	./configure --prefix=$PKG/usr

	make
	make MANDIR=/share/man install

	# Move password lists
	mkdir -p $PKG/usr/share/hydra
	mv $PKG/usr/etc/* $PKG/usr/share/hydra
	rm -rf $PKG/usr/etc

	#  Fix paths in dpl4hydra.sh
	sed -i -e "s|^INSTALLDIR=.*|INSTALLDIR=/usr|" $PKG/usr/bin/dpl4hydra.sh
	sed -i -e "s|^LOCATION=.*|LOCATION=share/hydra|" $PKG/usr/bin/dpl4hydra.sh
}
